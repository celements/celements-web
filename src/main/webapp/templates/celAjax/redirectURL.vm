## request url has to conform to HttpServletResponse.sendRedirect(String), see javadoc
#set($url = "$!request.url")
#if("$!url" == "")
   #set($url = $doc.getExternalURL())
#end

#set($blacklisted = false)
#foreach($illegal in ["xxx","porn","t.co","4serial","ac.id","cleantalkorg2.ru","amazonaws.com","tiny.cc","bit.do","u.to"-])
  #if($url.contains($illegal))
    #set($blacklisted = true)
  #end
#end

## set context finished to prevent any content written to the Body
$context.setFinished(true)
#if($blacklisted)
  $response.setStatus(403)
#else
  $services.celementsweb.sendRedirect($url)
#end
