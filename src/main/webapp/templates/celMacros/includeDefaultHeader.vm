## includeDefaultHeader
## include standard title- and meta-tags for the HTML header.
## INPUT (optional): $charEncoding
## OUTPUT:
##
#if("$!charEncoding" == '')##
  #set($charEncoding = "$xwiki.encoding")##
#end
#set($layoutApi = $services.layout.getPageLayoutApiForDocRef($doc.getDocumentReference()))##
#if(("$!layoutApi" != '') && ("$!layoutApi.getHTMLType().name()" == 'HTML5'))##
$!services.metatag.getCharsetMetaTag("$!charEncoding").display()
#else
$services.metatag.addMetaTagToCollector('http-equiv', 'Content-Type', "text/html; charset=$!charEncoding")
#end
$!xwiki.getSpacePreference("meta")
#if($services.celementsweb.hasGoogleAnalytics())
  $services.metatag.addMetaTagToCollector('name', 'cel-GAA-Num', "$services.celementsweb.getGoogleAnalytics()")
#end
$!services.metatag.displayCollectedMetaTags()## cel-GAA-Num is needed in initCelements.min.js while loading
<title>##
$services.celementsweb.getDocHeaderTitle($doc.documentReference)##
</title>
#set($layoutName = $services.layout.getPageLayoutForDoc($doc.documentReference))##
#set($layoutWebHomeDoc = '')##
#if("$!layoutName" != '')##
#set($layoutWebHomeRef = $services.model.createDocumentReference('', $layoutName, 'WebHome'))##
#set($layoutWebHomeDoc = $services.modelAccess.getDocument($layoutWebHomeRef))##
#end
#set($webprefDocRef = $services.model.createDocumentReference('', "${doc.space}", "WebPreferences"))##
#set($webprefDoc = $services.modelAccess.getDocument($webprefDocRef))##
#set($xwikiprefDocRef = $services.model.createDocumentReference('', "XWiki", "XWikiPreferences"))##
#set($wikiprefDoc = $services.modelAccess.getDocument($xwikiprefDocRef))##
#if(("$!layoutWebHomeDoc" != '') && ("$!layoutWebHomeDoc.getAttachment('favicon.ico')" != ''))##
<link rel="shortcut icon" href="$layoutWebHomeDoc.getAttachmentURL('favicon.ico','file')" type="image/x-icon"/>
#elseif("$!webprefDoc.getAttachment('favicon.ico')" != '')##
<link rel="shortcut icon" href="$webprefDoc.getAttachmentURL('favicon.ico','file')" type="image/x-icon"/>
#elseif("$!wikiprefDoc.getAttachment('favicon.ico')" != '')##
<link rel="shortcut icon" href="$wikiprefDoc.getAttachmentURL('favicon.ico','file')" type="image/x-icon"/>
#elseif("$!skin_doc.getAttachment('favicon.ico')" != '')##
<link rel="shortcut icon" href="$skin_doc.getAttachmentURL('favicon.ico','file')" type="image/x-icon"/>
#elseif($xwiki.getSkinFile('skinRes/favicon.ico', true).contains('/resources/'))##
<link rel="shortcut icon" href="$xwiki.getSkinFile('skinRes/favicon.ico', true)" type="image/x-icon"/>
#end
##TODO add reset CSS
## always load celements.css to prevent unequal behaviour if logged in or not
$services.css.includeCSSPage(':celRes/celements2.css')##
$services.css.includeCSSPage(':celRes/login.css')##
#if($xwiki.getXWikiPreferenceAsInt("cel_dynamic_layout_js_defaults", 0) == 1)##
  #parse('celMacros/jsDefaults/cel6JSdefaults.vm')
#else
  #parse('celMacros/jsDefaults/defaultLayoutJS.vm')
#end